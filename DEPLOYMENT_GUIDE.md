# SwiftAPI Deployment Guide

Complete guide to deploy SwiftAPI backend and connect it to your frontend.

## What's Already Done âœ…

- âœ… Frontend deployed to Vercel at https://swiftapi.ai
- âœ… GitHub repository at https://github.com/theonlypal/swiftapi
- âœ… Railway project created: https://railway.com/project/91da69ab-f43e-4dd3-80ad-62ae9d04c7ae
- âœ… PostgreSQL and Redis services added to Railway

## What You Need to Setup ðŸ”§

### 1. Railway Backend Deployment (5 minutes)

**Go to:** https://railway.com/project/91da69ab-f43e-4dd3-80ad-62ae9d04c7ae

**Step 1: Create New Service**
1. Click "+ New Service"
2. Select "GitHub Repo"
3. Choose `theonlypal/swiftapi`
4. Set Root Directory: `backend`
5. Click "Deploy"

**Step 2: Add Environment Variables**

Click on the new service â†’ Variables tab â†’ Add these:

```bash
# Database (Railway provides this automatically - click "Add Reference" and select DATABASE_URL from Postgres service)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Redis (click "Add Reference" and select REDIS_URL from Redis service)
REDIS_URL=${{Redis.REDIS_URL}}

# Secret Key (generate with: openssl rand -hex 32)
SECRET_KEY=<paste-your-generated-secret-key>

# Stripe (get from https://dashboard.stripe.com/test/apikeys)
STRIPE_SECRET_KEY=sk_test_<your_stripe_key>
STRIPE_WEBHOOK_SECRET=whsec_<your_webhook_secret>
```

**Step 3: Generate Domain**
1. Go to Settings tab
2. Click "Generate Domain"
3. Copy the URL (looks like: `swiftapi-backend-production.up.railway.app`)

### 2. Stripe Setup (10 minutes)

**Create Stripe Account:**
1. Go to https://stripe.com
2. Sign up for free account
3. Stay in Test Mode (for now)

**Get API Keys:**
1. Dashboard â†’ Developers â†’ API keys
2. Copy "Secret key" (starts with `sk_test_`)
3. Paste into Railway environment variable: `STRIPE_SECRET_KEY`

**Create Subscription Products:**
1. Dashboard â†’ Products â†’ Add product
2. Create 4 products:
   - **Indie**: $49/month recurring
   - **Pro**: $199/month recurring
   - **Enterprise**: $999/month recurring
3. Copy price IDs (start with `price_`)

**Setup Webhook:**
1. Dashboard â†’ Developers â†’ Webhooks â†’ Add endpoint
2. URL: `https://your-backend.railway.app/webhooks/stripe`
3. Events to send:
   - `checkout.session.completed`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
4. Copy "Signing secret" (starts with `whsec_`)
5. Paste into Railway: `STRIPE_WEBHOOK_SECRET`

### 3. Connect Frontend to Backend (2 minutes)

**Go to Vercel:** https://vercel.com/rayan-pals-projects/swiftapi/settings/environment-variables

**Add Environment Variable:**
```
Name: NEXT_PUBLIC_API_URL
Value: https://your-backend.railway.app
Environment: Production, Preview, Development
```

Click "Save" â†’ Trigger redeploy

### 4. Initialize Database (1 minute)

**One-time setup to create tables:**

**Option A - Railway CLI:**
```bash
cd C:\Users\Rayan Pal\Desktop\SWIFTAPI\backend
railway run python -c "from database import Base, engine; Base.metadata.create_all(bind=engine)"
```

**Option B - Railway Dashboard:**
1. Go to your backend service
2. Click "Deployments" tab
3. Click on latest deployment
4. Click "View Logs"
5. The app will auto-create tables on first request to `/health`

### 5. Test the System (2 minutes)

**Visit:** https://swiftapi.ai

1. Click "Sign up"
2. Enter email and password
3. Should create account and redirect to dashboard
4. Try creating an API key
5. View usage statistics

## Environment Variables Checklist

**Backend (Railway):**
- [ ] `DATABASE_URL` - Auto-generated by Railway Postgres
- [ ] `REDIS_URL` - Auto-generated by Railway Redis
- [ ] `SECRET_KEY` - Generate with: `openssl rand -hex 32`
- [ ] `STRIPE_SECRET_KEY` - From Stripe Dashboard
- [ ] `STRIPE_WEBHOOK_SECRET` - From Stripe Webhooks

**Frontend (Vercel):**
- [ ] `NEXT_PUBLIC_API_URL` - Your Railway backend URL

## Quick Commands

**Generate SECRET_KEY:**
```bash
openssl rand -hex 32
```

**Test Backend Health:**
```bash
curl https://your-backend.railway.app/health
```

**Test Frontend API Connection:**
```bash
curl https://swiftapi.ai/api/health
```

**View Railway Logs:**
```bash
cd backend
railway logs
```

## Troubleshooting

**Frontend shows API errors:**
- Check `NEXT_PUBLIC_API_URL` is set in Vercel
- Verify backend is deployed and running on Railway
- Check Railway logs for errors

**Backend won't start:**
- Verify all environment variables are set
- Check Railway build logs for Python errors
- Ensure `DATABASE_URL` and `REDIS_URL` are connected

**Stripe webhooks failing:**
- Verify webhook URL is: `https://your-backend.railway.app/webhooks/stripe`
- Check `STRIPE_WEBHOOK_SECRET` matches Stripe dashboard
- View Stripe webhook logs in dashboard

**Database connection errors:**
- Railway Postgres must be in same project
- Use `${{Postgres.DATABASE_URL}}` reference syntax
- Check database service is running

## What Happens Next

Once deployed:

1. Users can sign up at swiftapi.ai
2. They get Free tier (1,000 API calls/month)
3. They can create API keys
4. They can upgrade to paid tiers via Stripe
5. You capture 2% of all transactions OR $0.05 per API call

## Cost Breakdown

**Railway (Backend hosting):**
- Hobby Plan: $5/month (500 hours)
- Includes: 8GB RAM, 8GB disk, 100GB transfer
- PostgreSQL + Redis included

**Stripe (Payment processing):**
- 2.9% + 30Â¢ per transaction
- You charge 2% platform fee on top

**Vercel (Frontend hosting):**
- Free tier: Unlimited bandwidth
- Hobby: $20/month if needed

**Total:** ~$5-25/month to run infrastructure that can generate $1M+/year

## Revenue Example

With 100 developers each processing $10,000/month:
- Monthly volume: $1,000,000
- Your 2% fee: $20,000/month
- Minus Stripe fees (2.9%): $14,200/month
- Minus infrastructure ($25): $14,175/month
- **Annual revenue: ~$170,000**

---

**Railway Project:** https://railway.com/project/91da69ab-f43e-4dd3-80ad-62ae9d04c7ae

**Next Step:** Go to Railway dashboard and complete Step 1 above to deploy the backend service.
